{# This template only works if the needed javascript is included in the main page #}
{% load i18n %}
<input class="ajax-input" type="text" name="{{name}}" id="{{html_id}}" value="{{ current_result }}" {{ extra_attrs }} />
<a id="{{ html_id }}_clear" href="javascript:void(0)" class="ajax-clearfield"><div><span>Clear</span></div></a>
{% if add_link %}
    <a href="{{ add_link }}" class="add-another" id="add_{{ html_id }}" onclick="return showAddAnotherPopup(this);"> <img src="{{ admin_media_prefix }}img/admin/icon_addlink.gif" width="10" height="10" alt="Add Another"></a>
{% endif %}
{% block help %}{# {% if help_text %}<p class="help">{{help_text}}</p>{% endif %} #}{% endblock %}
<input type="hidden" name="{{name}}" id="{{html_id}}_hidden" value="{{current_id}}" />
<script type="text/javascript">
$("#{{ html_id }}").autocomplete("{{ lookup_url }}", {
    width: 320,
    formatItem: function(row) { return row[2]; },
    formatResult: function(row) { return row[1]; },
    mustMatch: "true"{% if autofill %},
    extraParams: {"extra":"{{ autofill.related_field }}"}
    {% endif %}
});
$("#{{ html_id }}_clear").click(function(){
    input_id = this.id;
    input_id = input_id.replace("_clear", "");
    $("#" + input_id).val("");
    $("#" + input_id + "_hidden").val("");
    $("#" + this.id).hide();
});
$("#{{ html_id }}").keypress(function(){
    $("#" + this.id + "_hidden").val("");
});
function receiveResult(event, data) {
    input_id = this.id;
    $("#" + input_id + "_hidden").val(data[0]);
    $("#" + input_id).val(data[1]);
    $("#" + input_id + "_clear").show();
    {% if autofill %}
    replace = input_id;
    replace = replace.split("-");
    replace = replace.slice(0,-1);
    replace.push("{{ autofill.field }}");
    replace = replace.join("-");
    $("#"+replace).val(data[3]);
    {% endif %}
}
$("#{{html_id}}").result(receiveResult);

if($("#{{ html_id }}_hidden").val()) {
    $("#{{ html_id }}_clear").show();
}
else{
    $("#{{ html_id }}_clear").hide();
}
$("#{{ html_id }}").bind('didAddPopup',function(event,id,repr) {
    data = Array();
    data[0] = id;
    data[1] = repr;
    receiveResult(null,data);
});
</script>
